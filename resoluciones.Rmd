---
title: "Resolución de Problemas - Teoría de la Decisión"
author: "Grupo 8 "
date: "`r Sys.Date()`"
output: html_document

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,warning = FALSE)
```

# Problemas Fernando
Antes de comenzar con los problemas, cargamos las funciones necesarias:
```{r}
source("teoriadecision_funciones_incertidumbre.R")
```

## Problema 1 (Tabla de valores)

Planteamos la siguiente tabla de beneficios:

```{r}
y.1<-matrix(c(50,100,150,
              -100,300,700,
              -350,500,1200),nrow=3,byrow=T)
colnames(y.1)<-c("e1","e2","e3")
rownames(y.1)<-c("a1","a2","a3")
library(knitr)
library(kableExtra)

kable(y.1, 
      caption = "Tabla de Decisión bajo Incertidumbre (Beneficios)", 
      align = 'c', 
      col.names = colnames(y.1)) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F) %>%
  row_spec(0, bold = T, background = "lightblue")
```

### 1. Criterio de Wald (pesimista)

```{r}
wald<- criterio.Wald(y.1, favorable=TRUE)

df_wald<-data.frame(
  Alternativa = names(wald$ValorAlternativas),
  Minimos = wald$ValorAlternativas,
  Decision = ifelse(names(wald$ValorAlternativas) %in% names(wald$AlternativaOptima),
                    paste0(wald$ValorOptimo, " (Óptima)"), ""))

kable(df_wald, caption = "Criterio de Wald", align = 'c') %>%
  kable_styling(bootstrap_options = "striped", full_width = F) %>%
  row_spec(0, bold = T, background = "lightblue")
```

La mejor alternativa para maximizar el resultado mínimo es $a_1$

### 2. Criterio optimista

```{r}
res.optimista<- criterio.Optimista(y.1, favorable=TRUE)
df_optimista<-data.frame(
  Alternativa = names(res.optimista$ValorAlternativas),
  Maximos = res.optimista$ValorAlternativas,
  Decision = ifelse(names(res.optimista$ValorAlternativas) %in% names(res.optimista$AlternativaOptima),
                    paste0(res.optimista$ValorOptimo, " (Óptima)"), ""))
kable(df_optimista, caption = "Criterio Optimista", align = 'c') %>%
  kable_styling(bootstrap_options = "striped", full_width = F) %>%
  row_spec(0, bold = T, background = "lightblue")
```

La mejor alternativa para maximizar el resultado máximo es $a_3$

### 3. Criterio de Hurwicz

Primero se fija un $\alpha \in [0,1]$ que represente el nivel de optimismo del decisor. En este caso tomamos $\alpha=0.7$ estando en el caso de un decisor bastante optimista.

```{r}
alfa<-0.7
res.hurwicz<- criterio.Hurwicz(y.1, alfa=alfa, favorable=T)
df_hurwicz<-data.frame(
  Alternativa = names(res.hurwicz$ValorAlternativas),
  Valores = round(res.hurwicz$ValorAlternativas,2),
  Decision = ifelse(names(res.hurwicz$ValorAlternativas) %in% names(res.hurwicz$AlternativaOptima),
                    paste0(round(res.hurwicz$ValorOptimo,2), " (Óptima)"), ""))
kable(df_hurwicz, caption = paste0("Criterio de Hurwicz (alfa=", alfa, ")"), align = 'c') %>%
  kable_styling(bootstrap_options = "striped", full_width = F) %>%
  row_spec(0, bold = T, background = "lightblue")
```

La mejor alternativa con un nivel de optimismo $\alpha = 0.7$ es $a_3$


Representamos graficamente el comportamiento de $a_1,a_2$ y $a_3$ en función del valor de $\alpha$:
```{r}
dibuja.criterio.Hurwicz(y.1, favorable=T)
```

En el gráfico se observa que en el valor $\alpha=0.7$ la alternativa con un valor mayor es $a_3$. En casos muy pesimistas de por ejemplo, $\alpha=0.1$ la alternativa óptima sería $a_1$, si por el contrario el valor de $\alpha$ fuera algo menos pesimista, por ejemplo $\alpha=0.3$ la mejor elección sería $a_2$

### 4. Criterio de Savage
```{r}
res.savage<- criterio.Savage(y.1, favorable=T)
df_savage<-data.frame(
  Alternativa = names(res.savage$ValorAlternativas),
  Valores = res.savage$ValorAlternativas,
  Decision = ifelse(names(res.savage$ValorAlternativas) %in% names(res.savage$AlternativaOptima),
                    paste0(res.savage$ValorOptimo, " (Óptima)"), ""))
kable(df_savage, caption = "Criterio de Savage", align = 'c') %>%
  kable_styling(bootstrap_options = "striped", full_width = F) %>%
  row_spec(0, bold = T, background = "lightblue")
```
La mejor alternativa para minimizar el arrepentimiento máximo es $a_3$

### 5. Criterio de Laplace
```{r}
res.laplace<- criterio.Laplace(y.1, favorable=T)
df_laplace<-data.frame(
  Alternativa = names(res.laplace$ValorAlternativas),
  Valores = round(res.laplace$ValorAlternativas,2),
  Decision = ifelse(names(res.laplace$ValorAlternativas) %in% names(res.laplace$AlternativaOptima),
                    paste0(round(res.laplace$ValorOptimo,2), " (Óptima)"), ""))
kable(df_laplace, caption = "Criterio de Laplace", align = 'c') %>%
  kable_styling(bootstrap_options = "striped", full_width = F) %>%
  row_spec(0, bold = T, background = "lightblue")
```
La mejor alternativa asumiendo que los estados son equiprobables es $a_3$

### 6. Criterio del punto ideal
```{r}
res.puntoideal<- criterio.PuntoIdeal(y.1, favorable=T)
df_puntoideal<-data.frame(
  Alternativa = names(res.puntoideal$ValorAlternativas),
  Valores = round(res.puntoideal$ValorAlternativas,2),
  Decision = ifelse(names(res.puntoideal$ValorAlternativas) %in% names(res.puntoideal$AlternativaOptima),
                    paste0(round(res.puntoideal$ValorOptimo,2), " (Óptima)"), ""))
kable(df_puntoideal, caption = "Criterio del Punto Ideal", align = 'c') %>%
  kable_styling(bootstrap_options = "striped", full_width = F) %>%
  row_spec(0, bold = T, background = "lightblue")
```
La alternativa más cercana al punto ideal es $a_3$


## Problema 2 (Situación real)

Un agricultor se plantea cuándo debería empezar a sembrar su cultivo, las tres opciones que tiene son: hacer una siembra temprana; que permite la correcta maduración del cultivo en caso de sequía, sembrar normalmente; que será lo ideal en caso de clima equilibrado, o hacer una siembra tardía; que permite el crecimiento adecuado en caso de lluvias excesivas.

$d_1$:Hacer una siembra temprana.\
$d_2$:Hacer una siembra normal.\
$d_3$:Hacer una siembra tardía.

La decisión debe tomarse teniendo en cuenta el posible clima que se presente en los meses siguientes a la siembra, el cual es totalmente impredecible, por lo que no podemos estimar ninguna probabilidad de precipitación. Estos estados climáticos pueden ser:

$e_1$:Clima seco y poco lluvioso.\
$e_2$:Clima equilibrado con lluvias repartidas de manera uniforme.\
$e_3$:Clima húmedo con lluvias excesivas.

El beneficio esperado en cada una de las situaciones planteadas es el siguiente:

```{r}
y.2<-matrix(c(300,450,100,
              250,500,200,
              150,350,400),nrow=3,byrow=T)
colnames(y.2)<-c("e1","e2","e3")
rownames(y.2)<-c("d1","d2","d3")

kable(y.2, 
      caption = "Beneficio según tipo de siembra y clima (en miles de €)", 
      align = 'c', 
      col.names = colnames(y.2)) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F) %>%
  row_spec(0, bold = T, background = "lightgray")
```
Plantemos entonces una tabla que contenga a todos los criterios de decisión bajo incertidumbre con los datos:

```{r}
res.todos<-criterio.Todos(y.2, alfa=0.7, favorable=TRUE)
kable(res.todos, caption = "Resumen de criterios de decisión bajo incertidumbre", align = 'c') %>%
  kable_styling(bootstrap_options = "striped", full_width = F) %>%
  row_spec(0, bold = T, background = "lightgray")
```
De acuerdo a los diferentes criterios utilizados, la mejor alternativa a tomar es $d_2$, es decir, hacer una siembra normal. Ya que se considera la mejor alternativa $5$ veces.

# Problemas Candela

```{r cargar-funciones}
library(formattable)
library(webshot)

if(!requireNamespace("knitr", quietly = TRUE)) install.packages("knitr")
library(knitr)

source("teoriadecision_funciones_incertidumbre.R")

```


```{r}
favorable = TRUE

beneficios <- matrix(c(10, 5, 7,
                       4, 8, 6,
                       3, 9, 2),
                     nrow = 3, byrow = TRUE)
rownames(beneficios) <- c("d1", "d2", "d3")
colnames(beneficios) <- c("e1", "e2", "e3")
beneficios

tabla_beneficios <- criterio.Todos(beneficios, alfa = 0.3, favorable = TRUE)
knitr::kable(tabla_beneficios, caption = "Resultados de los criterios - Beneficios")

res_hur_03 <- criterio.Hurwicz(beneficios, alfa = 0.3, favorable = TRUE)
res_hur_07 <- criterio.Hurwicz(beneficios, alfa = 0.7, favorable = TRUE)

resumen_hur_ben <- data.frame(
  Alpha = c(0.3, 0.7),
  ValorOptimo = c(res_hur_03$ValorOptimo, res_hur_07$ValorOptimo),
  stringsAsFactors = FALSE
)

knitr::kable(resumen_hur_ben, caption = "Decisiones óptimas según Hurwicz - Beneficios")


```
En este problema, Lucía evalúa tres alternativas de decisión (d1, d2, d3) bajo tres estados de la naturaleza (e1, e2, e3), considerando beneficios expresados en miles de euros.

Al aplicar los distintos criterios de decisión bajo incertidumbre, se observa que la alternativa d1 es la más favorable en todos los casos:

Según el criterio de Wald (Maximin), d1 presenta el mayor valor mínimo de beneficio (5).

Con el criterio Optimista (Maximax), d1 obtiene el mayor beneficio posible (10).

El criterio de Hurwicz, tanto con α = 0.3 como con α = 0.7, también elige d1 como óptima, con valores de 6.5 y 8.5 respectivamente.

Los criterios de Laplace, Savage y Punto Ideal coinciden en seleccionar la alternativa d1.

En conclusión, la estrategia d1 resulta óptima de forma consistente independientemente del criterio adoptado. Lucía debería optar por d1 si su objetivo es maximizar los beneficios esperados frente a la incertidumbre.

```{r}

knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())

source("teoriadecision_funciones_incertidumbre.R")

vacaciones <- matrix(c(1200, 1200, 1200,
                       800, 1100, 1500,
                       300, 450, 600),
                     nrow = 3, byrow = TRUE)
rownames(vacaciones) <- c("A", "B", "C")
colnames(vacaciones) <- c("Alta", "Media", "Baja")
vacaciones

criterio.Optimista(vacaciones)
criterio.Hurwicz(vacaciones, alfa = 0.3)
criterio.Laplace(vacaciones)
criterio.PuntoIdeal(vacaciones)
criterio.Savage(vacaciones)
criterio.Wald(vacaciones)

# Mostrar matriz
knitr::kable(vacaciones, caption = "Matriz de costes - Vacaciones")


tabla_vacaciones <- criterio.Todos(vacaciones, alfa = 0.3, favorable = FALSE)

knitr::kable(tabla_vacaciones, caption = "Resultados de los criterios - Vacaciones")

# Aplicar Hurwicz con dos valores de alfa
res_hur_03 <- criterio.Hurwicz(vacaciones, alfa = 0.3, favorable = FALSE)
res_hur_07 <- criterio.Hurwicz(vacaciones, alfa = 0.7, favorable = FALSE)

# Función auxiliar para obtener nombres de decisiones
get_decision_names <- function(res_list, mat) {
  idx <- res_list$AlternativaOptima
  idx_num <- as.integer(idx)
  if (all(is.na(idx_num))) return(NA)
  paste(rownames(mat)[idx_num], collapse = ", ")
}

# Crear tabla resumen
resumen_hur <- data.frame(
  Alpha = c(0.3, 0.7),
  Decision_optima = c(get_decision_names(res_hur_03, vacaciones),
                      get_decision_names(res_hur_07, vacaciones)),
  ValorOptimo = c(res_hur_03$ValorOptimo, res_hur_07$ValorOptimo),
  stringsAsFactors = FALSE
)

knitr::kable(resumen_hur, caption = "Decisiones óptimas según Hurwicz")


```
En este segundo problema, Lucía analiza tres alternativas para organizar sus vacaciones:
A (a través de agencia), B (por cuenta propia) y C (realizando actividades locales), bajo tres escenarios posibles de disponibilidad (Alta, Media y Baja).
La matriz representa los costes asociados a cada opción (en euros), por lo que el objetivo es minimizarlos.

Al aplicar los distintos criterios de decisión bajo incertidumbre:

Según el criterio de Wald (Maximin), la alternativa C tiene el menor coste máximo (600 €).

Con el criterio Optimista (Minimin), C presenta también el menor coste mínimo (300 €).

El criterio de Hurwicz, tanto con α = 0.3 como con α = 0.7, selecciona C como la mejor opción, con valores de 510 € y 390 € respectivamente.

Los criterios de Laplace, Savage y Punto Ideal también apuntan a C como la más conveniente.

En resumen, si Lucía desea minimizar los costes y mantener una postura prudente ante la incertidumbre de disponibilidad, la opción C (actividades locales) es la más recomendable según todos los criterios aplicados.


# Problemas Dani

## Problema 1

Matriz de pagos
```{r}
source("teoriadecision_funciones_incertidumbre.R")

matrizP1 <- matrix(
c(220,  90, -40,
160, 120,  40,
110,  80,  60),
nrow = 3, byrow = TRUE,
dimnames = list(
c("A1","A2","A3"),
c("E1","E2","E3")
)
)
knitr::kable(matrizP1, caption = "Matriz de pagos (k€)", align = "r")

# modo favorable

wald_fav   <- criterio.Wald(matrizP1, favorable = TRUE)
opt_fav    <- criterio.Optimista(matrizP1, favorable = TRUE)
hur06_fav  <- criterio.Hurwicz(matrizP1, alfa = 0.6, favorable = TRUE)
lap_fav    <- criterio.Laplace(matrizP1, favorable = TRUE)
sav_fav    <- criterio.Savage(matrizP1, favorable = TRUE)

# Tabla resumen 

resumen_criterio <- function(res, alt_names) {
vals <- as.numeric(res$ValorAlternativas)
names(vals) <- alt_names
i_opt <- as.integer(res$AlternativaOptima[1])
data.frame(
Criterio = res$criterio,
Modo = res$metodo,
t(vals),
`Alt. optima` = alt_names[i_opt],
check.names = FALSE
)
}
alts_p1 <- rownames(matrizP1)

tab_fav <- do.call(rbind, list(
resumen_criterio(opt_fav,   alts_p1),
resumen_criterio(wald_fav,  alts_p1),
resumen_criterio(hur06_fav, alts_p1),
resumen_criterio(lap_fav,   alts_p1),
resumen_criterio(sav_fav,   alts_p1)
))
knitr::kable(tab_fav, caption = "Resumen de criterios (favorable)", align = "l")

# Matriz de arrepentimientos del criterio Savage

knitr::kable(sav_fav$Pesos, caption = "Matriz de arrepentimientos (favorable)", align = "r")

## Caso desfavorable
wald_des   <- criterio.Wald(matrizP1, favorable = FALSE)
opt_des    <- criterio.Optimista(matrizP1, favorable = FALSE)
hur04_des  <- criterio.Hurwicz(matrizP1, alfa = 0.4, favorable = FALSE)
lap_des    <- criterio.Laplace(matrizP1, favorable = FALSE)
sav_des    <- criterio.Savage(matrizP1, favorable = FALSE)

tab_des <- do.call(rbind, list(
resumen_criterio(opt_des,   alts_p1),
resumen_criterio(wald_des,  alts_p1),
resumen_criterio(hur04_des, alts_p1),
resumen_criterio(lap_des,   alts_p1),
resumen_criterio(sav_des,   alts_p1)
))
knitr::kable(tab_des, caption = "Problema 1 — Resumen de criterios (desfavorable)", align = "l")

# Matriz de arrepentimientos del criterio Savage

knitr::kable(sav_des$Pesos, caption = "Matriz de arrepentimientos (desfavorable)", align = "r")


```

### Conclusión

**Resumen por criterio:**
- **Maximax:** A1  
- **Maximin (Wald):** A3  
- **Hurwicz (alpha=0.6):** A1  
- **Hurwicz (alpha=0.4):** A2  
- **Laplace:** A2  
- **Minimax de arrepentimiento (Savage):** A2  

**Decisión final:** Como varios criterios orientados a la robustez (Hurwicz con alpha=0.4, Laplace y Savage) coinciden en **A2**, se recomienda **A2**.  
Si el decisor prioriza el mejor escenario, la preferencia sería **A1** (Maximax, Hurwicz 0.6); si desea un enfoque estrictamente conservador, **A3** (Wald).


## Problema 2

Una tienda online de moda con sede en Sevilla debe elegir **proveedor logístico** para la campaña de invierno. El resultado económico depende de la **incertidumbre de la demanda** durante la campaña.

**Alternativas (A):**
- **B1_Fijo**: contrato con cuota fija mensual alta y bajo coste variable (poca flexibilidad, buen rendimiento en picos).
- **B2_Flexible**: sin mínimo mensual; coste variable alto (mucha flexibilidad, protege en escenarios bajos).
- **B3_Hibrido**: fijo moderado + variable medio (solución de compromiso).

**Estados de la naturaleza (E):**
- **F1_Pico**: fuerte incremento de pedidos (picos por campañas/promos).
- **F2_Estable**: demanda en línea con la media histórica.
- **F3_Baja**: caída de pedidos respecto a lo esperado.

Los valores de la matriz son **beneficios netos** de la campaña (en k€). No se dispone de probabilidades para los estados y se debe **maximizar** el beneficio.


Matriz de pagos

```{r}


matrizP2 <- matrix(
c(180,120, 50,   # B1_Fijo
150,110, 70,   # B2_Flexible
165,125, 60),  # B3_Hibrido
nrow = 3, byrow = TRUE,
dimnames = list(
c("B1_Fijo","B2_Flexible","B3_Hibrido"),
c("F1_Pico","F2_Estable","F3_Baja")
)
)
knitr::kable(matrizP2, caption = "Matriz de pagos (k€)", align = "r")

## Tabla unica 


tabla_p2 <- criterio.Todos(matrizP2, alfa = 0.6, favorable = TRUE)
knitr::kable(tabla_p2, caption = "Todos los métodos (alpha=0.6, favorable)")


```

### Conclusión

**Resumen por criterio**
- **Maximax:** B1_Fijo  
- **Wald (pesimista):** B2_Flexible  
- **Hurwicz (alpha=0.6):** B1_Fijo  
- **Laplace:** B1_Fijo / B3_Hibrido *(empate)*  
- **Minimax de arrepentimiento (Savage):** B3_Hibrido  

**Decisión final:** Dado que **Savage** minimiza el peor arrepentimiento y recomienda **B3_Hibrido**, y **Laplace** también lo sitúa al nivel más alto (empatado), la opción **B3_Hibrido** se considera la **más robusta** y equilibrada.  
Si se prioriza el mejor escenario, la preferencia sería **B1_Fijo** (Maximax, Hurwicz 0.6); con un enfoque estrictamente conservador, **B2_Flexible** (Wald).

